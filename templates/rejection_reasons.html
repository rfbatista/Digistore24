{% extends "base.html" %}
{% load review_extras %}
{% block title %}Rejection reasons{% endblock %}
{% block content %}
<div>
    <p>Reviewed Predictions: {{ reviewed_count }}</p>
    <p>Pending Predictions: {{ pending_count }}</p>
</div>
    <ul>
        {% for prediction in predictions %}
            <li>
                <form method="post"
                      action="{% url 'update_prediction' prediction.id %}"
                      class="bg-gray-50 p-4 rounded-lg shadow-md mb-4">
                    {% csrf_token %}
                    <div class="mb-2">
                        <strong class="block text-lg text-gray-700">Product ID: {{ prediction.product.product_id }}</strong>
                    </div>
                    <div class="mb-2">
                        <strong class="block text-lg text-gray-700">Reason ID: {{ prediction.id }}</strong>
                    </div>
                    <div class="mb-2">
                        <label class="block text-gray-700" for="reason-{{ prediction.id }}">Reason:</label>
                        <input type="text"
                               name="reason"
                               id="reason-{{ prediction.id }}"
                               value="{{ prediction.reason }}"
                               class="border rounded w-full py-2 px-3 text-gray-700 focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="mb-2">
                        <label class="block text-gray-700" for="confidence-{{ prediction.id }}">Confidence:</label>
                        <input type="text"
                               name="confidence"
                               id="confidence-{{ prediction.id }}"
                               value="{{ prediction.confidence }}"
                               class="border rounded w-full py-2 px-3 text-gray-700 focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="mb-2">
                        <span class="text-gray-600">Created at: {{ prediction.created_at }}</span>
                    </div>
                    <div class="mb-2">
                        <span class="block text-gray-600">Related Reviews:</span>
                        <ul class="list-disc ml-5">
                            {% for review in prediction.predictionreview_set.all %}
                                <li>
                                    Reviewed: {{ review.reviewed }}, Decision: {{ review.decision|get_decision_display }}, Explanation: {{ review.corrected_explanation }}
                                    <br>
                                    <a href="{% url 'update_review_product' review.id %}"
                                       class="text-blue-500 hover:underline">Edit Review</a>
                                </li>
                            {% empty %}
                                <li>No reviews</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <button type="submit"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        Update
                    </button>
                </form>
            </li>
        {% empty %}
            <li>No rejection reasons available.</li>
        {% endfor %}
    </ul>
{% endblock %}
